FROM python:3.11-slim

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ñ… Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
RUN apt-get update && apt-get install -y \
    curl \
    wget \
    gnupg \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Python Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
COPY requirements_mcp.txt .
RUN pip install --no-cache-dir -r requirements_mcp.txt

# ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð´Ð°
COPY . .

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Playwright Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð¾Ð² Ð² /tmp
RUN playwright install chromium --force

# ÐŸÐµÑ€ÐµÐ¼ÐµÑ‰ÐµÐ½Ð¸Ðµ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð¾Ð² Ð² Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½ÑƒÑŽ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸ÑŽ
RUN mkdir -p /ms-playwright && \
    cp -r /root/.cache/ms-playwright /ms-playwright/

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ start.sh
RUN echo '#!/bin/bash\n\
export PLAYWRIGHT_BROWSERS_PATH=/ms-playwright\n\
export DISPLAY=:99\n\
echo "ðŸš€ Starting TourVisor MCP Server..."\n\
python3 http_server.py' > start.sh && chmod +x start.sh

EXPOSE 8080
CMD ["./start.sh"]
